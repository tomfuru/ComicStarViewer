--------------------------------------------------
コミケットカタログブラウザ65 チェックリスト 仕様書
--------------------------------------------------

○概要

この文章はコミケットカタログブラウザ65 によって保存される「チェックリスト」
のデータファイル形式を定義します。

◯コミケット65での変更点

・未登録サークルの保存が可能になり、形式が Ver1.02 になりました。

○チェックリストデータ形式

Comiket Catalog Browserの保存ファイル(共通形式)は、カンマ区切りのCSV形式です。

改行コードは環境に依存します。

  Macintosh版  0x0d    CR
  Windows版    0x0d0a  CRLF

このファイルを利用するプログラムは、改行コードが0x0d、0x0d0aのどちらでも
読める必要があり、加えて改行コードが0x0aでも読めることが望ましいです。

・ヘッダ部構造

ファイルの先頭行には、ファイルに関する情報が、項目ごとにカンマで区切られ、
下記表の順番で格納されています。

項番 データ名 備考 
1 signature   ファイルを判別するための、"CATAROM"という固定の文字列。 
2 バージョン  ファイル形式のバージョン。三桁の数値が文字列で入っている。

  バージョン番号の意味は次のように定義されます。
 
  ・XYZ でバージョンX.YZを意味する。 
  ・バージョン番号の最上位(X)が変化した場合
    形式に互換性が無い新バージョンです。
    対応していないアプリケーションは「扱うことが出来ないバージョン」と
    してエラー処理します。
  ・バージョン番号の二番目および三番目(YZ)が変化した場合
    項目の単純追加など、形式に後方互換性のある変更が加えられています。

   ※ カタログブラウザ65 では、Windows 版は Ver1.02形式で、また、
      Macintosh 版は Ver1.00 形式で保存されます。
      それぞれ相互のデータ運用上は問題は生じません。

3 イベント名  第何回目のコミックマーケットの保存ファイルかを判別するための文字列。
              
  今回は "ComicMarket65" という文字列になります。
  イベント名が変化した場合は、サークルに対するIDが合致していることは期待できません。

4 OS種別      
  
  保存したOSの種類。"MacOS"か"Windows"のどちらかで、
  これによりどちらのOSで保存したかを判別できる。
  これは格納されている漢字コードに影響を与える。
  将来はこの二つ以外の文字列が入る可能性もある。 

各レコードの後ろには、将来のバージョンで項目が追加される可能性があります。
このファイルを利用するプログラムは、想定より多い項目は無視する構造が望ましいです。

・データ部構造

2行目以降は、チェックしたサークル、あるいはメモを書き込んだサークルを
１レコードとし、それぞれを行単位で格納されます。１レコード内のデータは
カンマで句切られ、次の順番に並んでいます。

項番 データ名 備考 
1 サークルのシリアル番号 サークルデータ（C65ROM1.TXT〜C65ROM0.TXT）の先頭行を0とする、
  何行目のサークルかを表す。サークルデータは1日目、２日目、３日目、抽選漏れの順番で
  繋がっている

  Ver1.02 形式から、データが存在しない未登録サークルについても、
  シリアル番号 -1 として保持されるようになりました。
  未登録サークルは、旧版のデータを読み込んだ時にのみ作成されます。
  カタログブラウザからの新規登録はできません。

2 チェックカラー番号 0〜9の整数。1〜9はチェックしたカラーの番号を表す。
  0の時はメモが記入されていてサークルがチェックされていない場合になる
3 ページ サークルデータのページ番号と同じ値が入る。 
4 カットインデックス サークルデータのカットインデックスと同じ値が入る。 
5 参加曜日 サークルデータの参加曜日と同じ値が入る。 
6 配置地区 サークルデータの配置地区と同じ値が入る。 
7 ブロック名 サークルデータのブロック名と同じ値が入る。 
8 スペース番号 サークルデータのスペース番号と同じ値が入る。 
9 ジャンルコード サークルデータのジャンルコードと同じ値が入る。 
10 サークル名 サークルデータのサークル名と同じ値が入る。 
11 執筆者名 サークルデータの執筆者名と同じ値が入る。 
12 発行誌名 サークルデータの発行誌名と同じ値が入る。 
13 ＵＲＬ サークルデータのＵＲＬと同じ値が入る。 
14 メールアドレス サークルデータのメールアドレスと同じ値が入る。 
15 補足説明 サークルデータの補足説明と同じ値が入る。 
16 配置図のX座標 サークルデータの配置図のX座標と同じ値が入る。 
17 配置図のY座標 サークルデータの配置図のY座標と同じ値が入る。 
18 メモ カタログブラウザ上から入力されたメモの内容が入る。
   ただし、メモの中の改行コードは、「\n」という2文字の文字列で表現する。
   これにともない、「\」そのものは、「\\」とこれを二つ続けることで表現する。 
19 サークル名の読み仮名 サークルデータのサークル名の読み仮名と同じ値が入る。 

形式 Ver1.01 から追加になる項目

20 配置図のX座標 マップ情報ファイルの X座標と同じ値が入る。
21 配置図のY座標 マップ情報ファイルの Y座標と同じ値が入る
22 配置図のテーブルレイアウト情報 マップ情報ファイルのレイアウトと同じ値が入る
23 スペース配置 aの場合:0 bの場合:1 

3〜17及び19は、順番は異なりますが、カタログCD-ROMのサークルデータと同じ内容が
入ります。ただし、Macintosh版で保存した時は、機種依存文字は可能な限りMacの
文字コードに変換し「仝」もハートマークに変換されています。

20,21,22 は新しいマップ情報ファイルでの座標情報が入ります。
23 は印刷処理補助のために、内部的にもつ情報を追加で足してあります。

各項目は次の仕様で格納されます。

 ・データの中にカンマが含まれている時は、その項目はダブルクォートで括られる
 ・項目がダブルクォートで括られている時は、その中のダブルクォートは二つ連続で
   入れることにより、括るのに使用しているダブルクォートと区別される
 ・項目の端のデータがダブルクォートの時はその項目は必ずダブルクォートで括られる
   (データかどうかの区別のため)
 ・各項目は常にダブルクォートで括ってもかまわない

メモの中の改行コードを「\n」で表現するのは、標準的なCSVファイルとは仕様が
異なりますが、これはエディタのようなCSVを意識しないソフトでも行単位で編集が
できるようにと配慮したものです。これに伴い、「\」そのものは、これを二つ
続けることにより表現されます。

各レコードの後ろには、将来のバージョンで項目が追加される可能性があります。
このファイルを利用するプログラムは、想定より多い項目は無視する構造が望ましいです。

項目番号20番以降を参照するプログラムは、バージョン番号を確認して、
101 以上である場合のみに使う必要があります。バージョン番号が 100 の
データにはこの項目は存在しません。

参考情報

カタログブラウザ65 はデータ読み込み時に次の項目を参照して動作します。
これらの動作は参考のために記述されたものであり、将来的には変更される
可能性があります。

 Macintosh 版

  (1)項番1 のサークルID を参照してサークルを決定します
  (2)項番2 で色を決定します。
  
   発見できないサークルは無視されます
   
 Windows 版

  (1)サークルIDの決定

  イベント名(コミケットの開催回数)が同じ場合

   a. 項番1のサークルID を参照してサークルを決定します
   b. 項番1が存在しない場合、項番3と4の配置情報からサークルを決定します
   c. 項番1が -1 の場合、未登録サークルとして登録します

  イベント名が同じでもサークルが特定できない場合、またはイベント名が異なる場合

   c. (項番10 OR 項番19) AND 項番11が合致するサークルを検索します
   d. 項番10 OR 項番19 OR 項番11 が合致するサークルを検索します
 
   c と d において複数のサークルが合致する場合はその全てをチェック対象にします。
  それでもみつからない場合は未登録サークルとして登録します。

    ※未登録サークルの情報は保存時にもそのまま記録されます

  (2)項番2 で色を決定します。
